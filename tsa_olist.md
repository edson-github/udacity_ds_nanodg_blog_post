# Time Series Analysis of Brazilian Marketplace Olist: What's to learn?
Any company that sells products online today, benefits from the data generated by the many options available to introduce 
quality event tracking for user journeys and product usage. On the flip side, the more data a company can track and store, 
the more complexity an analyst needs to deal with, particularly as the number of dimensions grow.

One basic task of any analyst is to make sense of time series data. Using almost two years of data from the Brazilian Ecommerce 
company [Olist](https://www.olist.com), which was made available through [Kaggle](https://www.kaggle.com/olistbr/brazilian-ecommerce), 
I want to answer the following key questions:

1. Which product categories contribute the most to total products purchased?
2. From which cities are most products being bought from?
3. Is there any seasonality to the number of orders placed?

By answering these questions we take a simple but important step in understanding the demand side of Olist. 

## Who is Olist?
Olist is a brazilian startup that helps merchants, particularly brick-and-mortar ones, to sell their products in different 
online and physical marketplaces. Olist provides technology to their sellers to optimize the way their 
products are placed in different online marketplaces, and to track their performance across all the marketplaces where 
they are being sold.

## The data
The data used for the analysis covers the time frame between January 1st 2017 until August 31st 2018, and it's only 
a sample of Olist's actual orders. Aggregations have been performed on orders and the products that make up these orders. 
The data made available by Olist was of good quality and did not have many missing values. 
Feel free to check the cleaning and preparation steps [here](https://github.com/juloi/udacity_ds_nanodg_blog_post).

## Which product categories contribute the most to total products purchased?
The way the question is currently formulated is deceiving in an important way: it makes one think that there is a single 
answer to this question. With time series data, a specific product category might contribute the most to total products 
purchased in a given month, and then nothing a couple months later. The better question would then be:

*Which product categories contribute the most to total products purchased, **over time**?*

Let's first see the number of total products sold for all categories over time in a simple monthly graph:

monthly_products_plot.png

The blue line is the number of daily products sold, the orange line is an exponentially weighted average, and the green line is
a simple moving average. Without digging into details, the exponentially weighted average places more value on the previous months closer to the
month for which the average is calculated, while a simple moving average places the same value for all previous months. 
Thus the shape of the exponentially weighted average is closer to the actual monthly values. 

We can see that there is an upwards trend in products sold throughout 2017, starting with around 1000 products per month 
and going up to around 5500 monthly, with a big spike of around 8000 close to the end of the year. Afterwards the 
number of monthly products sold remains stable around 8000 and seems to start going downwards. 

In the dataset, we have 72 categories but let's have a look a the top 10 categories in terms of products sold for the whole 
dataset to get a sense of how much they contribute.

top10_product_categories_products_table.png

The categories `bed_bath_table` and `health_beauty` are the top two with close to 10% and 8.5% of all products sold respectively, followed 
by `sports_leisure` with 7.6%. The cumulative share of these 3 categories already makes up more than 25% of all products sold. 
The top ten categories make up 63.6% of total products sold.

But does this hold over time? 

top10_categories_monthly_share_products_heatmap.png next to top10_categories_monthly_abs_products_heatmap.png next to monthly_total_products_table.png

Although the monthly values vary a bit, we can see from the first heatmap that `bed_bath_table` and `health_beauty` 
consistently have the biggest share of monthly products sold, with `health_and_beauty` contributing a few more percentage 
points in the last months of the dataset. From the above graph we know that there was steady growth across 2017. This growth 
does not seem to come from a particular category as can be seen in the second heatmap that contains the absolute number of 
products sold per category per month. Since all categories hold more or less the same share of products sold across time, 
we know that their growth pace is similar. Two categories that stand out are `housewares` and `watches_gits` that from May 2018 onwards, 
take the third and fourth spot in terms of largest contributing categories to products sold. 

## From which cities are most products being bought from?
Taking the same approach as we did with product categories, we can first analyze which cities contribute the most to 
total products sold across the entire time span, followed by a monthly analysis. 
The number of cities from which at least one product was purchased for the complete time series is 4107, which is significantly 
higher than the number of categories in which products are placed.

top10_cities_products_table.png

In contrast to our analysis of the top 10 product categories, the top 10 cities from which products were bought from, only have a cumulative share 
of 35.5% from total products sold in the complete timespan. 16% comes from Sao Paolo and 7% from Rio de Janeiro, so we can clearly 
see that these two cities contribute the most to products purchased from any individual city. The rest of the cities in the top 10 contribute between 0.9% 
to 2.7% each. What about the rest of cities?

city_product_count_summary_statistics_table.png

The above table has some summary statistics for all observations of monthly products sold across all cities. We can see that the 
the 75th percentile of monthly products sold per city in this dataset is **1**. This is a very strong indication that cities 
beyond the top 10 contribute a high amount of products sold as a group but not individually.

top10_cities_monthly_share_products_heatmap.png next to top10_cities_monthly_abs_products_heatmap.png next to monthly_total_products_table.png

Based on the heatmaps for the share of monthly products sold and the total monthly products sold per city, we can see that 
Sao Paolo contributes the most every month in terms of products sold, followed always by Rio de Janeiro in second place. 
Sao Paolo seems to contribute around 3x more than Rio de Janeiro, and around 10x more products than any city other than Rio de Janeiro.

Knowing that beyond Sao Paolo and Rio de Janeiro, products and therefore orders are coming in small amounts from several small cities poses 
and interesting strategic challenge for Olist. Should they try to focus on growing their presence in Sao Paolo and Rio de Janeiro 
where they already see bigger volumes or should they consider trying to make smaller gains across Brazil, knowing that a small increase 
across the whole country could potentially have a big impact?

## Is there any seasonality to the number of orders placed?
An important aspect of optimizing an ecommerce business is knowing when you have the most and least demand to tweak your 
product and operations accordingly. A simple way to analyze daily seasonality is to plot the trends of orders for each day 
of the week separately across the full time series.

weekday_orders_plot.png

The above graph shows the plot lines of exponentially weighted averages for the number of orders placed for each day of the week. 
Tuesday is clearly the day in which customers place the most orders at Olist, followed by Wednesdays.
Knowing that Tuesdays generates the most orders can help Olist better communicate with external stakeholders like logistics partners, 
making sure that they have enough capacity available to pick up products.    


## Conclusion
From our analysis, we now know that the `bed_bath_table` and `health_beauty` categories have generated the most products sold 
over time from the 42 product categories that Olist offers. We also learned that Olist has received orders from over 4000 cities, 
and that Sao Paolo and Rio de Janeiro have consistently been the individual cities that produce the highest number of products sold. 
Nevertheless, on any given month, the aggregate of the small number of purchases coming from smaller cities contribute the most to products sold 
for Olist. Lastly, we know that Olist sees a higher number of orders on Tuesdays than in any other day of the week.

Like most analysis, answering these basic question has lead us to pose further questions:
* Why do we see so little variation in terms of share of total products bought from the different categories? Are there any specific sellers in the
 top categories that continuously do a good job of placing their products and therefore always driving more purchases?
* Olist has thousands of cities from which customers have placed orders but should they focus on growing their presence in
 the cities where they see more demand already, or focus on the long tail of smaller cities that in aggregate could generate a big increase in orders 
 and products purchased?
* Why do people buy more on Tuesdays? Are there any actions Olist can take in their operations, like informing logistic 
partners to expect more numbers from them on Tuesdays?

We now have a better understanding of the basic demand dynamics of Olist and some further analysis questions. With this, 
I want to thank you for reading this blog post!

If you want to have a look at more graphs and further analysis, please checkout the repo for this analysis [here](https://github.com/juloi/udacity_ds_nanodg_blog_post)    
   